<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/src/styles.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=IBM+Plex+Sans:wght@400;500;600&display=swap"
    />
    <title>Trispr Flow</title>
    <script type="module" src="/src/main.ts" defer></script>
  </head>
  <body>
    <div class="bg-noise"></div>
    <div id="toast-container" class="toast-container"
         role="region"
         aria-live="polite"
         aria-label="Notifications"></div>
    <div id="recording-announcement" class="sr-only"
         role="status"
         aria-live="assertive"
         aria-atomic="true"></div>
    <div id="transcribe-announcement" class="sr-only"
         role="status"
         aria-live="polite"
         aria-atomic="true"></div>
    <main class="app">
      <header class="hero" style="--delay: 0.05s">
        <div>
          <div class="badge" id="dictation-badge">Offline dictation</div>
          <h1>Trispr Flow</h1>
          <p class="subtitle">
            GPU-first voice capture and transcription for English + Deutsch, with
            a privacy-first local pipeline and optional Claude fallback.
          </p>
          <div class="status" role="status" aria-live="polite">
            <div class="status-item">
              <span id="recording-pill" class="status-pill status-pill--disabled">Recording</span>
              <span class="status-dot" id="status-dot" data-state="idle"
                    aria-label="Recording status: idle"></span>
              <span id="status-label" class="status-label">Recording: Idle</span>
            </div>
            <div class="status-item">
              <span id="transcribe-pill" class="status-pill status-pill--disabled">Transcribing</span>
              <span class="status-dot" id="transcribe-dot" data-state="idle"
                    aria-label="Transcribing status: idle"></span>
              <span id="transcribe-label" class="status-label">Transcribing: Idle</span>
            </div>
            <span id="status-message" class="status-message" role="alert"></span>
          </div>
        </div>
        <div class="panel hero-card">
          <div class="hero-item">
            <span class="hero-label">Claude fallback <span id="cloud-check" class="hero-check">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" style="width: 12px; height: 12px; display: inline-block; vertical-align: middle;">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
              </svg>
            </span></span>
            <label class="hero-checkbox">
              <input id="cloud-toggle" type="checkbox" />
              <span id="cloud-state">Claude Off</span>
            </label>
          </div>
          <div class="hero-item">
            <span class="hero-label">Input Transcription</span>
            <span id="device-state" class="hero-value truncate-two">Default (System)</span>
          </div>
          <div class="hero-item">
            <span class="hero-label">Capture Mode</span>
            <span id="mode-state" class="hero-value">PTT</span>
          </div>
          <div class="hero-item">
            <span class="hero-label">Output Transcription</span>
            <span id="transcribe-status-pill" class="status-pill status-pill--disabled">Disabled</span>
            <span id="output-device-state" class="hero-value truncate-two">Default (System)</span>
          </div>
          <div class="hero-item">
            <span class="hero-label">Model</span>
            <span id="model-state" class="hero-value truncate-two">—</span>
          </div>
          <div class="hero-item hero-item-empty"></div>
        </div>
      </header>

      <div class="layout-grid">
        <section class="panel output-panel" data-panel="output" style="--delay: 0.12s">
          <div class="panel-header">
            <div class="panel-title">
              <h2>Output</h2>
              <p>Latest transcripts. Switch between input and output.</p>
            </div>
            <div class="panel-actions">
              <button class="panel-collapse-btn"
                      data-panel-collapse="output"
                      title="Collapse"
                      aria-expanded="true"
                      aria-controls="output-panel-body"
                      aria-label="Collapse output panel">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>
              </button>
            </div>
          </div>
          <div class="panel-body">
            <div class="history-tabs">
              <button id="history-tab-mic" class="history-tab active">Input</button>
              <button id="history-tab-system" class="history-tab">Output</button>
              <button id="history-tab-conversation" class="history-tab">Conversation</button>
            </div>
            <div class="history-toolbar">
              <button id="history-copy-conversation" class="ghost-btn">Copy conversation</button>
              <button id="history-detach-conversation" class="ghost-btn">Detach</button>
              <div id="conversation-font-controls" class="font-controls">
                <span class="font-label">Font</span>
                <input id="conversation-font-size" type="range" min="12" max="24" step="1"
                       aria-valuemin="12"
                       aria-valuemax="24"
                       aria-valuenow="16"
                       aria-label="Conversation font size"
                       aria-describedby="conversation-font-size-value" />
                <span id="conversation-font-size-value" class="font-value" aria-live="polite">16px</span>
              </div>
            </div>
            <div id="history-list" class="history-list"></div>
            <div class="history-compose">
              <input id="history-input" type="text" placeholder="Type a test entry..." />
              <button id="history-add">Add to history</button>
            </div>
          </div>
        </section>

        <section class="panel capture-panel" data-panel="capture" style="--delay: 0.16s">
          <div class="panel-header">
            <div class="panel-title">
              <h2>Capture Input</h2>
              <p>Hotkeys, input device, recording mode.</p>
            </div>
            <div class="panel-actions">
              <button class="panel-collapse-btn"
                      data-panel-collapse="capture"
                      title="Collapse"
                      aria-expanded="true"
                      aria-controls="capture-panel-body"
                      aria-label="Collapse capture input panel">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>
              </button>
            </div>
          </div>
          <div class="panel-body">
            <div class="panel-grid">
            <div class="field toggle-with-hint span-2">
              <label class="toggle-row">
                <span class="field-label">Enable input capture</span>
                <input id="capture-enabled-toggle" type="checkbox" />
                <span class="toggle-track">
                  <span class="toggle-thumb"></span>
                </span>
              </label>
              <span class="toggle-hint">When disabled, input capture and hotkeys are inactive</span>
            </div>
            <label class="field">
              <span class="field-label">Input device</span>
              <select id="device-select"></select>
            </label>
            <label class="field">
              <span class="field-label">Capture mode</span>
              <select id="mode-select">
                <option value="ptt">Push-to-talk (PTT)</option>
                <option value="vad">Voice Activation</option>
              </select>
            </label>
            <label class="field">
              <span class="field-label">Language</span>
              <select id="language-select">
                <option value="auto">Auto-detect</option>
                <option value="en">English</option>
                <option value="de">Deutsch (German)</option>
                <option value="fr">Français (French)</option>
                <option value="es">Español (Spanish)</option>
                <option value="it">Italiano (Italian)</option>
                <option value="pt">Português (Portuguese)</option>
                <option value="nl">Nederlands (Dutch)</option>
                <option value="pl">Polski (Polish)</option>
                <option value="ru">Русский (Russian)</option>
                <option value="ja">日本語 (Japanese)</option>
                <option value="ko">한국어 (Korean)</option>
                <option value="zh">中文 (Chinese)</option>
                <option value="ar">العربية (Arabic)</option>
                <option value="tr">Türkçe (Turkish)</option>
                <option value="hi">हिन्दी (Hindi)</option>
              </select>
            </label>
            <label class="field toggle">
              <div class="toggle-row">
                <span class="field-label">Pin language</span>
                <input id="language-pinned-toggle" type="checkbox" />
                <span class="toggle-track">
                  <span class="toggle-thumb"></span>
                </span>
              </div>
              <span class="toggle-hint">Force selected language instead of auto-detection</span>
            </label>
            <div id="hotkeys-block" class="field-group">
              <div class="field hotkey-field">
                <span class="field-label">PTT hotkey (hold)</span>
                <div class="hotkey-input-group">
                  <input id="ptt-hotkey" type="text" placeholder="CommandOrControl+Shift+Space" readonly />
                  <button id="ptt-hotkey-record" class="hotkey-record-btn" title="Click to record hotkey">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 4px;">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z" />
                    </svg>
                    Record
                  </button>
                </div>
                <span id="ptt-hotkey-status" class="hotkey-status"
                      role="status"
                      aria-live="polite"></span>
              </div>
              <div class="field hotkey-field">
                <span class="field-label">Toggle hotkey (click)</span>
                <div class="hotkey-input-group">
                  <input id="toggle-hotkey" type="text" placeholder="CommandOrControl+Shift+M" readonly />
                  <button id="toggle-hotkey-record" class="hotkey-record-btn" title="Click to record hotkey">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 4px;">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z" />
                    </svg>
                    Record
                  </button>
                </div>
                <span id="toggle-hotkey-status" class="hotkey-status"
                      role="status"
                      aria-live="polite"></span>
              </div>
              <label class="field toggle">
                <span class="field-label">Use Voice Activation in PTT</span>
                <input id="ptt-use-vad-toggle" type="checkbox" />
                <span class="toggle-hint">Only record when audio exceeds threshold, even while holding PTT key</span>
              </label>
            </div>
            <div id="vad-block" class="field-group hidden">
              <label class="field range">
                <span class="field-label">Voice Activation threshold</span>
                <div class="range-row">
                  <input id="vad-threshold" type="range" min="-60" max="0" step="1"
                         aria-valuemin="-60"
                         aria-valuemax="0"
                         aria-valuenow="-34"
                         aria-label="Voice activation threshold"
                         aria-describedby="vad-threshold-value" />
                  <span id="vad-threshold-value" class="range-value" aria-live="polite">-34 dB</span>
                </div>
              </label>
              <label class="field range">
                <span class="field-label">Silence grace</span>
                <div class="range-row">
                  <input id="vad-silence" type="range" min="200" max="4000" step="50"
                         aria-valuemin="200"
                         aria-valuemax="4000"
                         aria-valuenow="700"
                         aria-label="Voice activation silence grace period"
                         aria-describedby="vad-silence-value" />
                  <span id="vad-silence-value" class="range-value" aria-live="polite">700 ms</span>
                </div>
              </label>
              <div class="field">
                <span class="field-label">Input level <span id="vad-level-dbm" class="dbm-value">-∞ dB</span></span>
                <div class="vad-meter-container">
                  <div id="vad-meter" class="vad-meter">
                    <div id="vad-meter-fill" class="vad-meter-fill"></div>
                    <div id="vad-marker-start" class="vad-marker vad-marker-start" title="Start threshold"></div>
                    <div id="vad-marker-sustain" class="vad-marker vad-marker-sustain" title="Sustain threshold (dynamic)"></div>
                  </div>
                  <div class="vad-meter-scale">
                    <span data-db="-60">-60</span>
                    <span data-db="-40">-40</span>
                    <span data-db="-20">-20</span>
                    <span data-db="0">0 dB</span>
                  </div>
                </div>
              </div>
              <label class="field range span-2">
                <span class="field-label">Mic input gain</span>
                <div class="range-row">
                  <input id="mic-gain" type="range" min="-30" max="30" step="1"
                         aria-valuemin="-30"
                         aria-valuemax="30"
                         aria-valuenow="0"
                       aria-label="Input gain"
                         aria-describedby="mic-gain-value" />
                  <span id="mic-gain-value" class="range-value" aria-live="polite">+0 dB</span>
                </div>
              </label>
            </div>
            <div class="field toggle span-2">
              <div class="toggle-row">
                <span class="field-label">Hallucination Filter</span>
                <input id="hallucination-filter-toggle" type="checkbox" />
                <span class="toggle-track">
                  <span class="toggle-thumb"></span>
                </span>
              </div>
              <span class="toggle-hint">Filter out low-energy noise and common hallucinations</span>
            </div>
            <div class="field toggle span-2">
              <div class="toggle-row">
                <span class="field-label">Activation Words</span>
                <input id="activation-words-toggle" type="checkbox" />
                <span class="toggle-track">
                  <span class="toggle-thumb"></span>
                </span>
              </div>
              <span class="toggle-hint">Only process transcripts containing trigger words</span>
            </div>
            <div id="activation-words-config" class="field span-2 hidden">
              <label class="field-label">Word list (one per line)</label>
              <textarea id="activation-words-list" rows="4"
                placeholder="computer&#10;hey assistant"
                class="activation-words-textarea"></textarea>
              <span class="field-hint">Case-insensitive word matching</span>
            </div>
            <label class="field toggle span-2">
              <span class="field-label">Audio cues</span>
              <input id="audio-cues-toggle" type="checkbox" />
              <span class="toggle-track">
                <span class="toggle-thumb"></span>
              </span>
            </label>
            <label class="field range span-2">
              <span class="field-label">Audio cue volume</span>
              <div class="range-row">
                <input id="audio-cues-volume" type="range" min="0" max="100" step="1"
                       aria-valuemin="0"
                       aria-valuemax="100"
                       aria-valuenow="30"
                       aria-label="Audio cue volume"
                       aria-describedby="audio-cues-volume-value" />
                <span id="audio-cues-volume-value" class="range-value" aria-live="polite">30%</span>
              </div>
            </label>
            </div>
          </div>
        </section>

        <section class="panel transcribe-panel" data-panel="system" style="--delay: 0.18s">
          <div class="panel-header">
            <div class="panel-title">
              <h2>Capture Output</h2>
              <p>Output device, transcribe hotkey, detection settings.</p>
            </div>
            <div class="panel-actions">
              <button class="panel-collapse-btn"
                      data-panel-collapse="system"
                      title="Collapse"
                      aria-expanded="true"
                      aria-controls="system-panel-body"
                      aria-label="Collapse capture output panel">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>
              </button>
            </div>
          </div>
          <div class="panel-body">
          <div class="panel-grid">
            <div class="field toggle-with-hint span-2">
              <label class="toggle-row">
                <span class="field-label">Enable output transcription</span>
                <input id="transcribe-enabled-toggle" type="checkbox" />
                <span class="toggle-track">
                  <span class="toggle-thumb"></span>
                </span>
              </label>
              <span class="toggle-hint">When disabled, output monitoring and transcription are inactive</span>
            </div>
            <label class="field">
                <span class="field-label">Output device</span>
              <select id="transcribe-device-select"></select>
            </label>
            <label class="field toggle">
              <span class="field-label">Use Voice Activation</span>
              <input id="transcribe-vad-toggle" type="checkbox" />
              <span class="toggle-track">
                <span class="toggle-thumb"></span>
              </span>
            </label>
            <div class="field hotkey-field span-2">
              <span class="field-label">Transcribe hotkey</span>
              <div class="hotkey-input-group">
                <input id="transcribe-hotkey" type="text" readonly />
                <button id="transcribe-hotkey-record" class="hotkey-record-btn" title="Click to record hotkey">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 4px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z" />
                  </svg>
                  Record
                </button>
              </div>
              <span id="transcribe-hotkey-status" class="hotkey-status"
                    role="status"
                    aria-live="polite"></span>
            </div>
            <label class="field range" id="transcribe-vad-threshold-field">
              <span class="field-label">Voice Activation threshold</span>
              <div class="range-row">
                <input id="transcribe-vad-threshold" type="range" min="-60" max="0" step="1"
                       aria-valuemin="-60"
                       aria-valuemax="0"
                       aria-valuenow="-28"
                       aria-label="Output voice activation threshold"
                       aria-describedby="transcribe-vad-threshold-value" />
                <span id="transcribe-vad-threshold-value" class="range-value" aria-live="polite">-28 dB</span>
              </div>
            </label>
            <label class="field range" id="transcribe-vad-silence-field">
              <span class="field-label">Grace silence</span>
              <div class="range-row">
                <input id="transcribe-vad-silence" type="range" min="200" max="5000" step="100"
                       aria-valuemin="200"
                       aria-valuemax="5000"
                       aria-valuenow="900"
                       aria-label="Output silence grace period"
                       aria-describedby="transcribe-vad-silence-value" />
                <span id="transcribe-vad-silence-value" class="range-value" aria-live="polite">0.9s</span>
              </div>
            </label>
            <div class="field span-2">
              <span class="field-label">Output level</span>
              <div class="meter-stack">
                <div class="meter-row">
                  <div id="transcribe-meter" class="vad-meter">
                    <div id="transcribe-meter-fill" class="vad-meter-fill"></div>
                    <div id="transcribe-meter-threshold" class="meter-threshold-marker"></div>
                  </div>
                  <span id="transcribe-meter-db" class="meter-db">-60 dB</span>
                </div>
                <div class="meter-scale">
                  <span>-60</span>
                  <span>-40</span>
                  <span>-20</span>
                  <span>0 dB</span>
                </div>
                <div class="meter-threshold-label" id="transcribe-threshold-label">
                  Threshold: <span id="transcribe-threshold-db">-60 dB</span>
                </div>
              </div>
            </div>
            <label class="field range span-2" id="transcribe-gain-field">
              <span class="field-label">Input gain</span>
              <div class="range-row">
                <input id="transcribe-gain" type="range" min="-30" max="30" step="1"
                       aria-valuemin="-30"
                       aria-valuemax="30"
                       aria-valuenow="0"
                       aria-label="Output input gain"
                       aria-describedby="transcribe-gain-value" />
                <span id="transcribe-gain-value" class="range-value" aria-live="polite">+0 dB</span>
              </div>
            </label>
            <label class="field range" id="transcribe-batch-field">
              <span class="field-label">Chunk interval</span>
              <span class="field-hint">How often system audio is chunked for transcription.</span>
              <div class="range-row">
                <input id="transcribe-batch-interval" type="range" min="4000" max="15000" step="1000"
                       aria-valuemin="4000"
                       aria-valuemax="15000"
                       aria-valuenow="8000"
                       aria-label="Output chunk interval"
                       aria-describedby="transcribe-batch-value" />
                <span id="transcribe-batch-value" class="range-value" aria-live="polite">8s</span>
              </div>
            </label>
            <label class="field range" id="transcribe-overlap-field">
              <span class="field-label">Chunk overlap</span>
              <span class="field-hint">Shared audio between chunks to keep words from splitting.</span>
              <div class="range-row">
                <input id="transcribe-chunk-overlap" type="range" min="0" max="3000" step="250"
                       aria-valuemin="0"
                       aria-valuemax="3000"
                       aria-valuenow="1000"
                       aria-label="Output chunk overlap duration"
                       aria-describedby="transcribe-overlap-value" />
                <span id="transcribe-overlap-value" class="range-value" aria-live="polite">1s</span>
              </div>
            </label>
          </div>
          </div>
        </section>

        <section class="panel" data-panel="postprocessing" style="--delay: 0.19s">
          <div class="panel-header">
            <div class="panel-title">
              <h2>Post-Processing</h2>
              <p>Enhance transcription quality with intelligent text refinement</p>
            </div>
            <div class="panel-actions">
              <button class="panel-collapse-btn"
                      data-panel-collapse="postprocessing"
                      title="Collapse"
                      aria-expanded="true"
                      aria-controls="postprocessing-panel-body"
                      aria-label="Collapse post-processing panel">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>
              </button>
            </div>
          </div>
          <div class="panel-body">
            <div class="panel-grid">

              <!-- Master toggle -->
              <div class="field toggle span-2">
                <label class="toggle-row">
                  <span class="field-label">Enable post-processing</span>
                  <input id="postproc-enabled" type="checkbox" />
                  <span class="toggle-track"><span class="toggle-thumb"></span></span>
                </label>
                <span class="toggle-hint">Apply intelligent text enhancements to transcriptions</span>
              </div>

              <div id="postproc-settings" class="span-2" style="display: none;">

                <!-- Language -->
                <label class="field">
                  <span class="field-label">Processing language</span>
                  <select id="postproc-language">
                    <option value="en">English</option>
                    <option value="de">Deutsch (German)</option>
                  </select>
                  <span class="field-hint">Language-specific rules for punctuation and capitalization</span>
                </label>

                <!-- Rule-based toggles -->
                <div class="field toggle">
                  <label class="toggle-row">
                    <span class="field-label">Punctuation</span>
                    <input id="postproc-punctuation" type="checkbox" />
                    <span class="toggle-track"><span class="toggle-thumb"></span></span>
                  </label>
                  <span class="toggle-hint">Add periods, commas, question marks</span>
                </div>

                <div class="field toggle">
                  <label class="toggle-row">
                    <span class="field-label">Capitalization</span>
                    <input id="postproc-capitalization" type="checkbox" />
                    <span class="toggle-track"><span class="toggle-thumb"></span></span>
                  </label>
                  <span class="toggle-hint">Capitalize sentences and proper words</span>
                </div>

                <div class="field toggle">
                  <label class="toggle-row">
                    <span class="field-label">Number normalization</span>
                    <input id="postproc-numbers" type="checkbox" />
                    <span class="toggle-track"><span class="toggle-thumb"></span></span>
                  </label>
                  <span class="toggle-hint">Convert number words to digits (e.g., "three" → "3")</span>
                </div>

                <!-- Custom Vocabulary -->
                <details class="expander span-2">
                  <summary>Custom Vocabulary</summary>
                  <div class="expander-content">
                    <div class="field toggle">
                      <label class="toggle-row">
                        <span class="field-label">Enable custom vocabulary</span>
                        <input id="postproc-custom-vocab-enabled" type="checkbox" />
                        <span class="toggle-track"><span class="toggle-thumb"></span></span>
                      </label>
                      <span class="toggle-hint">Replace specific words or phrases</span>
                    </div>
                    <div id="postproc-custom-vocab-config" style="display: none;">
                      <p class="field-hint" style="margin-bottom: 10px;">
                        Define word replacements with word boundary matching.
                        <span style="opacity: 0.7;">Example: <code style="font-size: 11px; padding: 2px 5px; background: rgba(255,255,255,0.05); border-radius: 3px;">api</code> → <code style="font-size: 11px; padding: 2px 5px; background: rgba(255,255,255,0.05); border-radius: 3px;">API</code></span>
                      </p>
                      <div class="custom-vocab-table">
                        <div class="vocab-header">
                          <span>Match Word</span>
                          <span>Replace With</span>
                          <span aria-label="Actions"></span>
                        </div>
                        <div id="postproc-vocab-rows">
                          <!-- Dynamically populated -->
                        </div>
                      </div>
                      <button id="postproc-vocab-add" class="btn-secondary" style="margin-top: 10px; font-size: 13px; font-weight: 600;">
                        <span style="font-size: 16px; margin-right: 4px; line-height: 1;">+</span> Add Entry
                      </button>
                    </div>
                  </div>
                </details>

              </div>
            </div>
          </div>
        </section>

        <section class="panel transcription-panel" data-panel="model" style="--delay: 0.18s">
          <div class="panel-header">
            <div class="panel-title">
              <h2>Model Manager</h2>
              <p>Download and manage local whisper.cpp models.</p>
            </div>
            <div class="panel-actions">
              <button class="panel-collapse-btn"
                      data-panel-collapse="model"
                      title="Collapse"
                      aria-expanded="true"
                      aria-controls="model-panel-body"
                      aria-label="Collapse model manager panel">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>
              </button>
            </div>
          </div>
          <div class="panel-body">
          <div class="model-manager">
            <div class="panel-grid model-source-grid">
              <label class="field">
                <span class="field-label">Source</span>
                <select id="model-source-select">
                  <option value="default">Default (whisper.cpp)</option>
                  <option value="custom">Custom URL</option>
                </select>
              </label>
              <label class="field span-2" id="model-custom-url-field">
                <span class="field-label">Custom model URL</span>
                <div class="hotkey-input-group">
                  <input
                    id="model-custom-url"
                    type="text"
                    placeholder="https://example.com/models.json or model.bin"
                  />
                  <button id="model-refresh" class="hotkey-record-btn">Refresh</button>
                </div>
                <span class="field-hint">Supports JSON index or direct model file URL.</span>
              </label>
            </div>
            <div class="panel-grid model-storage-grid">
              <label class="field span-2">
                <span class="field-label">Model storage</span>
                <div class="hotkey-input-group">
                  <input
                    id="model-storage-path"
                    type="text"
                    placeholder="Default (App data/models)"
                  />
                  <button id="model-storage-browse" class="hotkey-record-btn">Browse</button>
                  <button id="model-storage-reset" class="hotkey-record-btn">Reset</button>
                </div>
                <span class="field-hint">Choose where downloaded models are stored.</span>
              </label>
            </div>
            <div class="model-section">
              <div class="model-section-title">Models</div>
              <div id="model-list" class="model-list"></div>
              <p class="model-hint">Active models use the teal border. Available models are dimmed.</p>
            </div>
          </div>
          </div>
        </section>

        <section class="panel interface-panel" data-panel="interface" style="--delay: 0.22s">
          <div class="panel-header">
            <div class="panel-title">
              <h2>UX / UI-Adjustments</h2>
              <p>Overlay, layout, and visual feedback settings.</p>
            </div>
            <div class="panel-actions">
              <button class="panel-collapse-btn"
                      data-panel-collapse="interface"
                      title="Collapse"
                      aria-expanded="true"
                      aria-controls="interface-panel-body"
                      aria-label="Collapse UI adjustments panel">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                </svg>
              </button>
            </div>
          </div>
          <div class="panel-body">
          <div class="panel-grid">
            <div class="field hotkey-field span-2">
              <span class="field-label">Toggle activation words</span>
              <div class="hotkey-input-group">
                <input id="toggle-activation-words-hotkey" type="text" readonly />
                <button id="toggle-activation-words-hotkey-record" class="hotkey-record-btn" title="Click to record hotkey">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 4px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z" />
                  </svg>
                  Record
                </button>
              </div>
              <span id="toggle-activation-words-hotkey-status" class="hotkey-status"
                    role="status"
                    aria-live="polite"></span>
            </div>
          </div>
          <details class="expander">
            <summary>Overlay</summary>
            <div class="expander-body">
              <label class="field">
                <span class="field-label">Style</span>
                <select id="overlay-style">
                  <option value="dot">HAL 9000 by Space:2001®</option>
                  <option value="kitt">KITT by Dox®</option>
                </select>
              </label>
              <label class="field">
                <span class="field-label">Color</span>
                <input id="overlay-color" type="color" />
              </label>
              <!-- Dot mode settings -->
              <div id="overlay-dot-settings" class="settings-grid-2col">
              <label class="field range">
                <span class="field-label">Min radius (px)</span>
                <div class="range-row">
                  <input id="overlay-min-radius" type="range" min="4" max="32" step="1"
                         aria-valuemin="4"
                         aria-valuemax="32"
                         aria-valuenow="8"
                         aria-label="Overlay dot minimum radius"
                         aria-describedby="overlay-min-radius-value" />
                  <span id="overlay-min-radius-value" class="range-value" aria-live="polite">8</span>
                </div>
              </label>
              <label class="field range">
                <span class="field-label">Max radius (px)</span>
                <div class="range-row">
                  <input id="overlay-max-radius" type="range" min="8" max="64" step="1"
                         aria-valuemin="8"
                         aria-valuemax="64"
                         aria-valuenow="24"
                         aria-label="Overlay dot maximum radius"
                         aria-describedby="overlay-max-radius-value" />
                  <span id="overlay-max-radius-value" class="range-value" aria-live="polite">24</span>
                </div>
              </label>
              </div>
              <!-- KITT mode settings -->
              <div id="overlay-kitt-settings" class="settings-grid-2col" style="display: none;">
              <label class="field range">
                <span class="field-label">Min width (px)</span>
                <div class="range-row">
                  <input id="overlay-kitt-min-width" type="range" min="4" max="40" step="1"
                         aria-valuemin="4"
                         aria-valuemax="40"
                         aria-valuenow="20"
                         aria-label="Overlay KITT bar minimum width"
                         aria-describedby="overlay-kitt-min-width-value" />
                  <span id="overlay-kitt-min-width-value" class="range-value" aria-live="polite">20</span>
                </div>
              </label>
              <label class="field range">
                <span class="field-label">Max width (px)</span>
                <div class="range-row">
                  <input id="overlay-kitt-max-width" type="range" min="50" max="800" step="10"
                         aria-valuemin="50"
                         aria-valuemax="800"
                         aria-valuenow="200"
                         aria-label="Overlay KITT bar maximum width"
                         aria-describedby="overlay-kitt-max-width-value" />
                  <span id="overlay-kitt-max-width-value" class="range-value" aria-live="polite">200</span>
                </div>
              </label>
              <label class="field range span-2">
                <span class="field-label">Height (px)</span>
                <div class="range-row">
                  <input id="overlay-kitt-height" type="range" min="8" max="40" step="1"
                         aria-valuemin="8"
                         aria-valuemax="40"
                         aria-valuenow="20"
                         aria-label="Overlay KITT bar height"
                         aria-describedby="overlay-kitt-height-value" />
                  <span id="overlay-kitt-height-value" class="range-value" aria-live="polite">20</span>
                </div>
              </label>
              </div>
              <!-- Shared settings -->
              <div class="settings-grid-2col">
              <label class="field range">
                <span class="field-label">Rise smoothing (ms)</span>
                <div class="range-row">
                  <input id="overlay-rise" type="range" min="20" max="600" step="10"
                         aria-valuemin="20"
                         aria-valuemax="600"
                         aria-valuenow="80"
                         aria-label="Overlay animation rise smoothing"
                         aria-describedby="overlay-rise-value" />
                  <span id="overlay-rise-value" class="range-value" aria-live="polite">80</span>
                </div>
              </label>
              <label class="field range">
                <span class="field-label">Fall smoothing (ms)</span>
                <div class="range-row">
                  <input id="overlay-fall" type="range" min="20" max="800" step="10"
                         aria-valuemin="20"
                         aria-valuemax="800"
                         aria-valuenow="160"
                         aria-label="Overlay animation fall smoothing"
                         aria-describedby="overlay-fall-value" />
                  <span id="overlay-fall-value" class="range-value" aria-live="polite">160</span>
                </div>
              </label>
              <label class="field range">
                <span class="field-label">Inactive opacity</span>
                <div class="range-row">
                  <input id="overlay-opacity-inactive" type="range" min="5" max="100" step="1"
                         aria-valuemin="5"
                         aria-valuemax="100"
                         aria-valuenow="20"
                         aria-label="Overlay inactive opacity"
                         aria-describedby="overlay-opacity-inactive-value" />
                  <span id="overlay-opacity-inactive-value" class="range-value" aria-live="polite">20%</span>
                </div>
              </label>
              <label class="field range">
                <span class="field-label">Active opacity</span>
                <div class="range-row">
                  <input id="overlay-opacity-active" type="range" min="5" max="100" step="1"
                         aria-valuemin="5"
                         aria-valuemax="100"
                         aria-valuenow="80"
                         aria-label="Overlay active opacity"
                         aria-describedby="overlay-opacity-active-value" />
                  <span id="overlay-opacity-active-value" class="range-value" aria-live="polite">80%</span>
                </div>
              </label>
              </div>
              <div class="panel-grid">
                <label class="field">
                  <span class="field-label">Position X (%)</span>
                  <input id="overlay-pos-x" type="number" min="0" max="100" step="1" />
                </label>
                <label class="field">
                  <span class="field-label">Position Y (%)</span>
                  <input id="overlay-pos-y" type="number" min="0" max="100" step="1" />
                </label>
              </div>
              <button id="apply-overlay-btn" class="button primary" style="margin-top: 12px; width: 100%;">Apply Overlay Settings</button>
            </div>
          </details>
          </div>
        </section>

      </div>
    </main>
  </body>
</html>
