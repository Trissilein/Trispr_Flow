<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/src/styles.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=IBM+Plex+Sans:wght@400;500;600&display=swap"
    />
    <title>Trispr Flow</title>
    <script type="module" src="/src/main.ts" defer></script>
  </head>
  <body>
    <div class="bg-noise"></div>
    <div id="toast-container" class="toast-container"></div>
    <main class="app">
      <header class="hero" style="--delay: 0.05s">
        <div>
          <div class="badge">Offline dictation</div>
          <h1>Trispr Flow</h1>
          <p class="subtitle">
            GPU-first voice capture and transcription for English + Deutsch, with
            a privacy-first local pipeline and optional Claude fallback.
          </p>
          <div class="status">
            <span class="status-dot" id="status-dot" data-state="idle"></span>
            <span id="status-label">Idle</span>
            <span class="status-divider">â€¢</span>
            <span id="engine-label">whisper.cpp (GPU)</span>
            <span id="status-message" class="status-message"></span>
          </div>
        </div>
        <div class="hero-card">
          <div class="hero-row">
            <span class="hero-label">Cloud fallback</span>
            <span id="cloud-state" class="hero-value">Off</span>
          </div>
          <div class="hero-row">
            <span class="hero-label">Mode</span>
            <span id="mode-state" class="hero-value">PTT</span>
          </div>
          <div class="hero-row">
            <span class="hero-label">Input</span>
            <span id="device-state" class="hero-value">Default</span>
          </div>
        </div>
      </header>

      <div class="layout-grid">
        <section class="panel output-panel" style="--delay: 0.12s">
          <div class="panel-header">
            <h2>Output</h2>
            <p>Latest transcripts. Copy or paste as needed.</p>
          </div>
          <div id="history-list" class="history-list"></div>
          <div class="history-compose">
            <input id="history-input" type="text" placeholder="Type a test entry..." />
            <button id="history-add">Add to history</button>
          </div>
        </section>

        <section class="panel capture-panel" style="--delay: 0.16s">
          <div class="panel-header">
            <h2>Capture</h2>
            <p>Hotkeys, input device, and recording mode.</p>
          </div>
          <div class="panel-grid">
            <label class="field">
              <span class="field-label">Mode</span>
              <select id="mode-select">
                <option value="ptt">Push-to-talk (PTT)</option>
                <option value="vad">Voice-Activated (VAD)</option>
              </select>
            </label>
            <div id="hotkeys-block" class="field-group">
              <div class="field hotkey-field">
                <span class="field-label">PTT hotkey (hold)</span>
                <div class="hotkey-input-group">
                  <input id="ptt-hotkey" type="text" placeholder="CommandOrControl+Shift+Space" readonly />
                  <button id="ptt-hotkey-record" class="hotkey-record-btn" title="Click to record hotkey">ðŸŽ¹ Record</button>
                </div>
                <span id="ptt-hotkey-status" class="hotkey-status"></span>
              </div>
              <div class="field hotkey-field">
                <span class="field-label">Toggle hotkey (click)</span>
                <div class="hotkey-input-group">
                  <input id="toggle-hotkey" type="text" placeholder="CommandOrControl+Shift+M" readonly />
                  <button id="toggle-hotkey-record" class="hotkey-record-btn" title="Click to record hotkey">ðŸŽ¹ Record</button>
                </div>
                <span id="toggle-hotkey-status" class="hotkey-status"></span>
              </div>
              <label class="field toggle">
                <span class="field-label">Use voice activation in PTT</span>
                <input id="ptt-use-vad-toggle" type="checkbox" />
                <span class="toggle-hint">Only record when audio exceeds threshold, even while holding PTT key</span>
              </label>
            </div>
            <div id="vad-block" class="field-group hidden">
              <label class="field range">
                <span class="field-label">VAD threshold</span>
                <div class="range-row">
                  <input id="vad-threshold" type="range" min="0" max="100" step="1" />
                  <span id="vad-threshold-value" class="range-value">0%</span>
                </div>
              </label>
              <label class="field range">
                <span class="field-label">Silence grace</span>
                <div class="range-row">
                  <input id="vad-silence" type="range" min="200" max="4000" step="50" />
                  <span id="vad-silence-value" class="range-value">700 ms</span>
                </div>
              </label>
              <div class="field">
                <span class="field-label">Input level <span id="vad-level-dbm" class="dbm-value">-âˆž dB</span></span>
                <div class="vad-meter-container">
                  <div id="vad-meter" class="vad-meter">
                    <div id="vad-meter-fill" class="vad-meter-fill"></div>
                    <div id="vad-marker-start" class="vad-marker vad-marker-start" title="Start threshold"></div>
                    <div id="vad-marker-sustain" class="vad-marker vad-marker-sustain" title="Sustain threshold (dynamic)"></div>
                  </div>
                  <div class="vad-meter-scale">
                    <span data-db="-60">-60</span>
                    <span data-db="-40">-40</span>
                    <span data-db="-20">-20</span>
                    <span data-db="0">0 dB</span>
                  </div>
                </div>
              </div>
            </div>
            <label class="field">
              <span class="field-label">Input device</span>
              <select id="device-select"></select>
            </label>
          </div>
        </section>

        <section class="panel transcription-panel" style="--delay: 0.2s">
          <div class="panel-header">
            <h2>Transcription</h2>
            <p>Model quality, language detection, and advanced options.</p>
          </div>
          <div class="panel-grid">
            <label class="field">
              <span class="field-label">Model</span>
              <select id="model-select">
                <option value="whisper-large-v3">Whisper large-v3 (quality)</option>
                <option value="whisper-large-v3-turbo">Whisper large-v3-turbo (speed)</option>
              </select>
            </label>
            <label class="field">
              <span class="field-label">Language</span>
              <select id="language-select">
                <option value="auto">Auto (DE/EN mix)</option>
              </select>
            </label>
          </div>

          <details class="expander">
            <summary>Advanced</summary>
            <div class="expander-body">
              <label class="field toggle">
                <span class="field-label">Claude fallback</span>
                <input id="cloud-toggle" type="checkbox" />
                <span class="toggle-track">
                  <span class="toggle-thumb"></span>
                </span>
              </label>
              <label class="field toggle">
                <span class="field-label">Audio cues</span>
                <input id="audio-cues-toggle" type="checkbox" />
                <span class="toggle-track">
                  <span class="toggle-thumb"></span>
                </span>
              </label>
              <label class="field range">
                <span class="field-label">Audio cue volume</span>
                <div class="range-row">
                  <input id="audio-cues-volume" type="range" min="0" max="100" step="1" />
                  <span id="audio-cues-volume-value" class="range-value">30%</span>
                </div>
              </label>
              <div class="field note">
                <span class="field-label">Backend</span>
                <div class="field-value">whisper.cpp (GPU auto-detect, CPU fallback)</div>
              </div>
            </div>
          </details>
        </section>

        <section class="panel interface-panel" style="--delay: 0.22s">
          <div class="panel-header">
            <h2>Interface</h2>
            <p>Overlay, layout, and visual feedback settings.</p>
          </div>
          <details class="expander">
            <summary>Overlay</summary>
            <div class="expander-body">
              <label class="field">
                <span class="field-label">Dot color</span>
                <input id="overlay-color" type="color" />
              </label>
              <label class="field range">
                <span class="field-label">Min radius (px)</span>
                <div class="range-row">
                  <input id="overlay-min-radius" type="range" min="4" max="32" step="1" />
                  <span id="overlay-min-radius-value" class="range-value">8</span>
                </div>
              </label>
              <label class="field range">
                <span class="field-label">Max radius (px)</span>
                <div class="range-row">
                  <input id="overlay-max-radius" type="range" min="8" max="64" step="1" />
                  <span id="overlay-max-radius-value" class="range-value">24</span>
                </div>
              </label>
              <label class="field range">
                <span class="field-label">Rise smoothing (ms)</span>
                <div class="range-row">
                  <input id="overlay-rise" type="range" min="20" max="600" step="10" />
                  <span id="overlay-rise-value" class="range-value">80</span>
                </div>
              </label>
              <label class="field range">
                <span class="field-label">Fall smoothing (ms)</span>
                <div class="range-row">
                  <input id="overlay-fall" type="range" min="20" max="800" step="10" />
                  <span id="overlay-fall-value" class="range-value">160</span>
                </div>
              </label>
              <label class="field range">
                <span class="field-label">Inactive opacity</span>
                <div class="range-row">
                  <input id="overlay-opacity-inactive" type="range" min="5" max="100" step="1" />
                  <span id="overlay-opacity-inactive-value" class="range-value">20%</span>
                </div>
              </label>
              <label class="field range">
                <span class="field-label">Active opacity</span>
                <div class="range-row">
                  <input id="overlay-opacity-active" type="range" min="5" max="100" step="1" />
                  <span id="overlay-opacity-active-value" class="range-value">80%</span>
                </div>
              </label>
              <div class="panel-grid">
                <label class="field">
                  <span class="field-label">Position X</span>
                  <input id="overlay-pos-x" type="number" min="0" step="1" />
                </label>
                <label class="field">
                  <span class="field-label">Position Y</span>
                  <input id="overlay-pos-y" type="number" min="0" step="1" />
                </label>
              </div>
              <button id="apply-overlay-btn" class="button primary" style="margin-top: 12px; width: 100%;">Apply Overlay Settings</button>
            </div>
          </details>
        </section>

        <section class="panel model-panel" style="--delay: 0.24s">
          <div class="panel-header">
            <h2>Model manager</h2>
            <p>Download and manage local whisper.cpp models.</p>
          </div>
          <div id="model-list" class="model-list"></div>
        </section>
      </div>
    </main>
  </body>
</html>
