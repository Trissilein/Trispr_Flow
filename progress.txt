# Trispr Flow â€” Current Progress

**Last updated**: 2026-02-09 (v0.4.0 - Post-Processing Pipeline complete)

## âœ… Completed

### Core Platform
- Frontend modularized into focused TypeScript modules.
- Backend modularized (`audio`, `transcription`, `models`, `state`, `paths`).
- Security hardening implemented (URL safety, checksum verification, download limits).
- Unit + smoke baseline established (`npm run test`, `npm run test:smoke`).
- Model manager refined (single list, active-first sorting, 2-column grid).
- Model downloads fixed for DE turbo; delete vs remove semantics for internal/external models.

### Capture & Transcription UX
- Input/Output capture flows are available with dedicated panels.
- Recording/transcribing activity indicators split and visible in app UI.
- Transcribe defaults to disabled on app start (session-only enablement).

### Overlay & Tray
- Dot and KITT overlay styles are both supported.
- Overlay style switching and runtime behavior have been stabilized.
- Tray menu sync exists for mic/transcribe toggles.
- Overlay now has dedicated tray runtime toggle requirement documented (full on/off behavior).

### Model Optimization
- Quantizer (quantize.exe from whisper.cpp) integrated for model compression to q5_0 format (~30% size reduction).
- Optimize button added to Model Manager for user-initiated quantization.
- Model descriptions for all q5_0 variants (large-v3-turbo, large-v3, distil-large-v3, german-turbo).
- Quantizer bundled in NSIS installer; build-quantize.bat script for manual builds.
- Hero model display expanded to 2 lines for longer quantized model names.

### Window Behavior
- Main window position/size persisted across sessions with monitor validation.
- Conversation window geometry restored on reopen.
- Monitor-aware restoration with fallback to primary monitor if unplugged.
- Restoration logic properly integrated into Tauri setup phase.
- 500ms debounce prevents excessive I/O during resizing.
- Works correctly across Windows virtual desktops (implicit OS behavior).

### Activity Feedback
- Tray icon pulsing implemented (turquoise=Recording, yellow=Transcribing).
- Pulse cadence: ~1.6s loop with 6 frames.
- Both active indicators pulse simultaneously when both active.
- Thread-safe state management with atomic variables.
- Event-driven updates via capture:state and transcribe:state emissions.

### Conversation Window Configuration
- Conversation window geometry persisted across sessions (from Task 2).
- Always-on-top toggle added for user convenience.
- Setting persisted in config with Tauri command integration.
- UI checkbox in conversation window settings expander.
- Window position/size restoration with monitor awareness.

### Model Manager QoL - Hot Swap
- Model switching without app restart via apply_model command.
- Seamless transcription restart if currently active.
- Rollback to previous model on apply failure.
- \"Apply\" button visible for non-active installed models.
- Success/error toast feedback on model switch.
- Event emission for model change tracking.

### Capture Enhancements
- Language Pinning: Fixed critical bug in transcription.rs (line 887 hardcoded "auto").
- Language dropdown with 16 languages (English, German, French, Spanish, Italian, Portuguese, Dutch, Polish, Russian, Japanese, Korean, Chinese, Arabic, Turkish, Hindi).
- Pin language toggle to force selected language instead of auto-detection.
- Activation Words: Word boundary matching filter (case-insensitive).
- Default activation word list: ["computer", "hey assistant"].
- Activation words UI with toggle + textarea for word list configuration.
- Filter integration in 3 transcription paths (PTT mode, toggle mode, transcribe worker).
- Hallucination Filter UI: Toggle for existing backend filter (previously JSON-only).
- Extra Hotkey: Ctrl+Shift+A to toggle activation words on/off.
- Hotkey handler with audio cues and settings persistence.
- Full frontend wiring (DOM refs, event listeners, rendering).

### Post-Processing Pipeline (v0.4.0)
- Rule-based text processing (punctuation, capitalization, numbers).
- English and German language-specific rules.
- Custom vocabulary with word boundary matching (HashMap + regex).
- Settings-driven with backward compatibility (#[serde(default)]).
- Punctuation enhancement: periods, commas, question mark detection.
- Capitalization: sentence start, English "I", German noun support.
- Number normalization: 0-100 + common tens (word boundary matching).
- Custom vocabulary: user-defined replacements with dynamic UI table.
- Add/remove functionality with instant persistence.
- Post-Processing UI panel: master toggle, language selector, rule toggles.
- Custom Vocabulary expander with styled grid table (1fr 1fr 32px).
- postprocessing.rs module with 3-stage pipeline architecture.
- Integration at 3 transcription emission points (mic PTT, mic VAD, system audio).
- Error handling with fallback to original text (never lose data).
- Comprehensive unit tests (24 tests covering all functions).

## ðŸ”„ Next Up

### Version 0.5.0 â€” Long-Form Features
**Goal**: Support extended recording sessions with organization tools

**Features**:
- Live transcript dump (export as TXT, MD, JSON)
- Chapter segmentation (automatic for meetings/lectures)
- Topic detection and marking
- Transcript search and navigation

**Status**: Spec phase

### Version 0.6.0 â€” VibeVoice-ASR Integration
**Goal**: Speaker diarization for recorded meetings

**Features**:
- Python FastAPI sidecar for VibeVoice-ASR 7B
- Post-session speaker-diarized transcripts
- WAV recording alongside live transcription
- Color-coded speaker view in UI

**Status**: Research phase

### Version 0.7.0 â€” AI Fallback Overhaul
**Goal**: Multi-provider cloud transcription with user choice

**Features**:
- OpenAI Whisper API, Anthropic, Groq support
- User-selectable models per provider
- Streaming transcription for real-time cloud fallback
- Cost tracking and usage analytics

**Status**: Concept phase

## ðŸ§© Known Follow-up Constraints
- `npm run build` currently fails on pre-existing TypeScript issues in:
  - `src/settings.ts` (`transcribeStatus` ref)
  - `src/ui-state.ts` (`output_device` typing)
- These are tracked as separate frontend cleanup tasks.
